"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[9548],{5894:function(e,t,l){l.r(t),l.d(t,{default:function(){return v}});var s=l(6252),a=l(3577);const i={class:"left-panel"},o={class:"title"},n={class:"right-panel"},r={class:"longText"},u={class:"longText"},d={class:"label"},c={class:"sheetBox"},m={class:"appraiseSheetName"},w={key:0},b={key:1},p={key:0};function f(e,t,l,f,h,_){const g=(0,s.up)("el-icon-list"),k=(0,s.up)("el-icon"),W=(0,s.up)("el-button"),S=(0,s.up)("el-header"),v=(0,s.up)("el-form-item"),x=(0,s.up)("el-col"),L=(0,s.up)("el-row"),y=(0,s.up)("el-table-column"),N=(0,s.up)("el-button-group"),C=(0,s.up)("scTable"),D=(0,s.up)("el-main"),z=(0,s.up)("el-container"),Z=(0,s.up)("save-dialog"),U=(0,s.up)("simplePhoto");return(0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(z,null,{default:(0,s.w5)((()=>[(0,s.Wm)(S,{class:"info"},{default:(0,s.w5)((()=>[(0,s._)("div",i,[(0,s.Wm)(k,{size:20,color:"var(--el-color-primary)"},{default:(0,s.w5)((()=>[(0,s.Wm)(g)])),_:1}),(0,s._)("div",o,(0,a.zw)(h.detail.business.businessShopName),1)]),(0,s._)("div",n,[(0,s.Wm)(W,{size:"default",onClick:_.back},{default:(0,s.w5)((()=>[(0,s.Uk)("返回")])),_:1},8,["onClick"]),(0,s.Wm)(W,{type:"primary",size:"default",onClick:_.showPhoto},{default:(0,s.w5)((()=>[(0,s.Uk)("基础照片")])),_:1},8,["onClick"])])])),_:1}),(0,s.Wm)(D,{style:{background:"#fff"}},{default:(0,s.w5)((()=>[(0,s.Wm)(L,{class:"infoHead"},{default:(0,s.w5)((()=>[(0,s.Wm)(x,{span:16},{default:(0,s.w5)((()=>[(0,s.Wm)(L,null,{default:(0,s.w5)((()=>[(0,s.Wm)(x,{xs:12,sm:12,md:8,lg:8,xl:8},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"客户经理:"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(h.detail.business.accountManagerName||"-"),1)])),_:1})])),_:1}),(0,s.Wm)(x,{xs:12,sm:12,md:8,lg:8,xl:8},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"区营销部:"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(h.detail.business.marketingDepartmentName||"-"),1)])),_:1})])),_:1}),(0,s.Wm)(x,{xs:12,sm:12,md:8,lg:8,xl:8},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"区市场部:"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(h.detail.business.organizationName||"-"),1)])),_:1})])),_:1}),(0,s.Wm)(x,{xs:12,sm:12,md:8,lg:8,xl:8},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"客户名称:"},{default:(0,s.w5)((()=>[(0,s._)("div",r,(0,a.zw)(h.detail.business.customerName||"-"),1)])),_:1})])),_:1}),(0,s.Wm)(x,{xs:12,sm:12,md:8,lg:8,xl:8},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"零售许可证号:"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(h.detail.business.retailLicenseNumber||"-"),1)])),_:1})])),_:1}),(0,s.Wm)(x,{xs:12,sm:12,md:8,lg:8,xl:8},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"客户电话:"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(h.detail.business.customerPhone||"-"),1)])),_:1})])),_:1}),(0,s.Wm)(x,{xs:24,sm:24,md:8,lg:8,xl:8},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"市场类型:"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(_.filterType(h.detail.business.marketType,h.marketList)),1)])),_:1})])),_:1}),(0,s.Wm)(x,{xs:24,sm:24,md:8,lg:8,xl:8},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"业态:"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(_.filterType(h.detail.business.businessType,h.businessList)),1)])),_:1})])),_:1}),(0,s.Wm)(x,{xs:12,sm:12,md:8,lg:8,xl:8},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"线路:"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(h.detail.business.deliveryRoute||"-"),1)])),_:1})])),_:1}),(0,s.Wm)(x,{xs:24,sm:24,md:8,lg:8,xl:8},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"档位:"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(h.detail.business.gear||"-"),1)])),_:1})])),_:1}),(0,s.Wm)(x,{xs:24,sm:24,md:16,lg:16,xl:16},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"店面经营地址:"},{default:(0,s.w5)((()=>[(0,s._)("div",u,(0,a.zw)(h.detail.business.businessAddress||"-"),1)])),_:1})])),_:1}),(0,s.Wm)(x,{xs:24,sm:24,md:8,lg:8,xl:8},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"调查人:"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(h.detail.business.surveyUserName||"-"),1)])),_:1})])),_:1}),(0,s.Wm)(x,{xs:24,sm:24,md:16,lg:16,xl:16},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"调查时间:"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(h.detail.business.completionTime||"-"),1)])),_:1})])),_:1}),(0,s.Wm)(x,{span:24},{default:(0,s.w5)((()=>[(0,s.Wm)(v,{label:"备注:"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(h.detail.result.remarks||"-"),1)])),_:1})])),_:1})])),_:1})])),_:1}),(0,s.Wm)(x,{span:8,class:"successBox"},{default:(0,s.w5)((()=>[(0,s._)("div",d,"总分："+(0,a.zw)(h.detail.business.totalScore||0),1)])),_:1})])),_:1}),(0,s._)("div",c,[(0,s._)("div",m,(0,a.zw)(h.detail.result.appraiseSheetName||"-"),1),(0,s.Wm)(C,{ref:"table",data:h.detail.topicListList,"span-method":_.objectSpanMethod,"table-layout":"auto",border:"",hiddenMin:"","highlight-current-row":!1,"row-key":"id",hideRefresh:"",hidePagination:"",hideDo:"","cell-style":_.changeCellStyle},{default:(0,s.w5)((()=>[(0,s.Wm)(y,{label:"检查项目",prop:"className","min-width":"150",align:"center"}),(0,s.Wm)(y,{label:"基本分",prop:"classBaseScore","min-width":"150",align:"center"}),(0,s.Wm)(y,{label:"检查要点",prop:"name","min-width":"500",align:"center"}),(0,s.Wm)(y,{label:"分值",prop:"score","min-width":"100",align:"center"},{default:(0,s.w5)((e=>[h.strShow.includes(e.row.no)?((0,s.wg)(),(0,s.iD)("div",w,"否决项")):((0,s.wg)(),(0,s.iD)("div",b,(0,a.zw)(1===e.row.combineStatus?e.row.combineScore:e.row.score),1))])),_:1}),(0,s.Wm)(y,{label:"得分",prop:"hitScore","min-width":"150",align:"center"},{default:(0,s.w5)((e=>[h.strShow.includes(e.row.no)?((0,s.wg)(),(0,s.iD)("div",p,"-")):((0,s.wg)(),(0,s.iD)("div",{key:1,style:(0,a.j5)(_.filterColor(e.row))},(0,a.zw)(1===e.row.combineStatus?e.row.combineHitScore:e.row.hitScore),5))])),_:1}),(0,s.Wm)(y,{label:"操作","min-width":"100",fixed:"right",align:"center"},{default:(0,s.w5)((e=>[(0,s.Wm)(N,null,{default:(0,s.w5)((()=>[(0,s.Wm)(W,{text:"",type:"primary",size:"small",onClick:t=>_.getData(e.row)},{default:(0,s.w5)((()=>[(0,s.Uk)("查看")])),_:2},1032,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data","span-method","cell-style"])])])),_:1})])),_:1}),h.dialog.save?((0,s.wg)(),(0,s.j4)(Z,{key:0,ref:"saveDialog",onSuccess:_.handleSaveSuccess,onClosed:t[0]||(t[0]=e=>h.dialog.save=!1)},null,8,["onSuccess"])):(0,s.kq)("",!0),h.dialog.photo?((0,s.wg)(),(0,s.j4)(U,{key:1,detail:h.detail,ref:"simplePhoto",onClosed:t[1]||(t[1]=e=>h.dialog.photo=!1)},null,8,["detail"])):(0,s.kq)("",!0)],64)}l(7658);var h=l(7707),_=l(2790),g=l(8201),k={name:"plan-detail",components:{saveDialog:h["default"],simplePhoto:_["default"]},data(){return{id:this.$route.query.id,input:"",dialog:{save:!1,photo:!1},strShow:["BZXZZD_CLASS_01_TOPIC_01","BZXZZD_CLASS_02_TOPIC_01"],detail:{business:{},images:[],result:{},topicClass:[],topicListList:[]},marketList:[{value:1,label:"城市"},{value:2,label:"乡村"},{value:3,label:"乡镇"}],businessList:[{value:1,label:"便利店"},{value:2,label:"超市"},{value:3,label:"商场"},{value:4,label:"烟酒店"},{value:5,label:"食杂店"},{value:6,label:"娱乐服务"},{value:7,label:"其他"}],spanArr:[]}},created(){},mounted(){this.getDetail(this.$route.query.id)},methods:{changeCellStyle(e){return"操作"===e.column.label?{background:"#fff"}:{background:"revert"}},filterColor(e){let t="";return 1===e.combineStatus?e.combineHitScore<e.combineScore&&(t="color: red;"):e.hitScore<e.score&&(t="color: red;"),t},getSpanArr(e){let t=[];for(var l=0;l<e.length;l++)0===l?(t.push(1),this.pos=0):e[l].classNo===e[l-1].classNo?(t[this.pos]+=1,t.push(0)):(t.push(1),this.pos=l);return t},objectSpanMethod({rowIndex:e,columnIndex:t}){if(0===t||1===t){const t=this.spanArr[e],l=t>0?1:0;return{rowspan:t,colspan:l}}if([3,4].includes(t)){const t=this.detail.topicListList[e-1],l=this.detail.topicListList[e],s=this.detail.topicListList[e+1];if(!s||l.classNo!==s.classNo)return[1,1];if(1===l.combineStatus&&l.combineNo===t.combineNo)return[0,1];if(1===l.combineStatus&&l.combineNo===s.combineNo)return[2,1]}else if([5].includes(t)){const l=this.detail.topicListList[e-2]||{},s=this.detail.topicListList[e-1]||{},a=this.detail.topicListList[e]||{},i=this.detail.topicListList[e+1];if(0===t&&0===e)return[1,1];if("BZXZZD_CLASS_02_TOPIC_01"===a.no&&"否"===a.selectOption)return[3,1];if("BZXZZD_CLASS_02_TOPIC_01"===l.no&&"否"===l.selectOption||"BZXZZD_CLASS_02_TOPIC_01"===s.no&&"否"===s.selectOption)return[0,1];if(!i||a.classNo!==i.classNo)return[1,1];if(1===a.combineStatus&&a.combineNo===s.combineNo)return[0,1];if(1===a.combineStatus&&a.combineNo===i.combineNo)return[2,1]}},getData(e){let t=[];const{combineStatus:l,combineNo:s}=e;switch(l){case 1:t=this.detail.topicListList.filter((e=>e.combineNo===s));break;case 2:t.push(e);break}this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open().setData(t)}))},filterType(e,t=[]){return t.find((t=>t.value===e))?.label||"-"},async getDetail(e){let t=await this.$API.researchInfo.ResearchCompany.GetPlanSheetDetail.get(e);200===t.code?(this.detail=t.data||{},this.spanArr=this.getSpanArr(t.data.topicListList)):g.Z.closeNext((()=>{this.$router.back()}))},back(){g.Z.closeNext((()=>{this.$router.back()}))},showPhoto(){this.dialog.photo=!0,this.$nextTick((()=>{this.$refs.simplePhoto.open()}))},handleClick(e){switch(e.props.name){case"1":this.$refs.RecycleDetail.initData();break;case"2":this.$refs.PlanUserList.initData();break;case"3":this.$refs.StoreList.initData();break}},handleSaveSuccess(e,t){"edit"==t&&this.getDetail(e.id)}}},W=l(3744);const S=(0,W.Z)(k,[["render",f],["__scopeId","data-v-ada0d3a6"]]);var v=S}}]);