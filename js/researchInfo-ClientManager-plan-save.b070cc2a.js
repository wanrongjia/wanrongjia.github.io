"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[9331],{1328:function(e,a,l){l.r(a),l.d(a,{default:function(){return u}});var s=l(6252);function r(e,a,l,r,t,i){const o=(0,s.up)("el-input"),d=(0,s.up)("el-form-item"),u=(0,s.up)("el-option"),m=(0,s.up)("el-select"),p=(0,s.up)("el-col"),n=(0,s.up)("el-row"),c=(0,s.up)("el-date-picker"),h=(0,s.up)("el-radio"),f=(0,s.up)("el-radio-group"),y=(0,s.up)("el-form"),b=(0,s.up)("el-button"),g=(0,s.up)("el-dialog");return(0,s.wg)(),(0,s.j4)(g,{title:t.titleMap[t.mode],modelValue:t.visible,"onUpdate:modelValue":a[13]||(a[13]=e=>t.visible=e),width:700,"destroy-on-close":"",onClosed:a[14]||(a[14]=a=>e.$emit("closed"))},{footer:(0,s.w5)((()=>[(0,s.Wm)(b,{onClick:a[10]||(a[10]=e=>t.visible=!1)},{default:(0,s.w5)((()=>[(0,s.Uk)("取 消")])),_:1}),["add"].includes(t.mode)?((0,s.wg)(),(0,s.j4)(b,{key:0,type:"primary",loading:t.isSaveing,onClick:a[11]||(a[11]=e=>i.submit())},{default:(0,s.w5)((()=>[(0,s.Uk)("保 存")])),_:1},8,["loading"])):(0,s.kq)("",!0),["edit"].includes(t.mode)?((0,s.wg)(),(0,s.j4)(b,{key:1,type:"primary",loading:t.isSaveing,onClick:a[12]||(a[12]=e=>i.editData())},{default:(0,s.w5)((()=>[(0,s.Uk)("保 存")])),_:1},8,["loading"])):(0,s.kq)("",!0)])),default:(0,s.w5)((()=>[(0,s.Wm)(y,{model:t.form,rules:t.rules,ref:"dialogForm","label-width":"140px"},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{label:"计划名称",prop:"name"},{default:(0,s.w5)((()=>[(0,s.Wm)(o,{modelValue:t.form.name,"onUpdate:modelValue":a[0]||(a[0]=e=>t.form.name=e),placeholder:"请输入计划名称",clearable:"",disabled:[4,5,6].includes(t.form.status)},null,8,["modelValue","disabled"])])),_:1}),(0,s.Wm)(d,{label:"选择评分表",prop:"sysAppraiseSheetNo"},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{style:{width:"100%"},modelValue:t.form.sysAppraiseSheetNo,"onUpdate:modelValue":a[1]||(a[1]=e=>t.form.sysAppraiseSheetNo=e),onChange:i.change,filterable:"",remote:"",clearable:"","reserve-keyword":"",placeholder:"请输入关键词",loading:t.loading,disabled:[2,3,4,5,6].includes(t.form.status)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(t.sysAppraiseList,((e,a)=>((0,s.wg)(),(0,s.j4)(u,{key:a,label:e.name,value:e.no},null,8,["label","value"])))),128))])),_:1},8,["modelValue","onChange","loading","disabled"])])),_:1}),(0,s.Wm)(n,null,{default:(0,s.w5)((()=>[(0,s.Wm)(p,{span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{label:"回收目标数",prop:"recoveryTargetCount"},{default:(0,s.w5)((()=>[(0,s.Wm)(o,{modelValue:t.form.recoveryTargetCount,"onUpdate:modelValue":a[2]||(a[2]=e=>t.form.recoveryTargetCount=e),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"请输入回收目标数",clearable:"",disabled:[4,5,6].includes(t.form.status)},null,8,["modelValue","disabled"])])),_:1})])),_:1}),(0,s.Wm)(p,{span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{label:"回收阀数值",prop:"recoveryDoorsillCount"},{default:(0,s.w5)((()=>[(0,s.Wm)(o,{modelValue:t.form.recoveryDoorsillCount,"onUpdate:modelValue":a[3]||(a[3]=e=>t.form.recoveryDoorsillCount=e),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"请输入回收阀值",clearable:"",disabled:[4,5,6].includes(t.form.status)},null,8,["modelValue","disabled"])])),_:1})])),_:1}),(0,s.Wm)(p,{span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{label:"调研对象",prop:"researchObjectType"},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{style:{width:"100%"},clearable:"",modelValue:t.form.researchObjectType,"onUpdate:modelValue":a[4]||(a[4]=e=>t.form.researchObjectType=e),filterable:"",placeholder:"请选择调研对象",disabled:[2,3,4,5,6].includes(t.form.status)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.researchObjectList,((e,a)=>((0,s.wg)(),(0,s.j4)(u,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1}),(0,s.Wm)(p,{span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{label:"所属部门",prop:"deptType"},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{style:{width:"100%"},clearable:"",modelValue:t.form.deptType,"onUpdate:modelValue":a[5]||(a[5]=e=>t.form.deptType=e),filterable:"",placeholder:"请选择所属部门",disabled:[2,3,4,5,6].includes(t.form.status)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.deptList,((e,a)=>((0,s.wg)(),(0,s.j4)(u,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1}),(0,s.Wm)(p,{span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{label:"调研周期",prop:"researchPeriodType"},{default:(0,s.w5)((()=>[(0,s.Wm)(m,{style:{width:"100%"},clearable:"",modelValue:t.form.researchPeriodType,"onUpdate:modelValue":a[6]||(a[6]=e=>t.form.researchPeriodType=e),filterable:"",placeholder:"请选择调研周期",disabled:[4,5,6].includes(t.form.status)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(l.researchPeriodList,((e,a)=>((0,s.wg)(),(0,s.j4)(u,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1})])),_:1}),(0,s.Wm)(d,{label:"调研起止时间",required:""},{default:(0,s.w5)((()=>[(0,s.Wm)(n,{style:{width:"100% !important"},gutter:10},{default:(0,s.w5)((()=>[(0,s.Wm)(p,{span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{prop:"startTime"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{style:{width:"100%"},modelValue:t.form.startTime,"onUpdate:modelValue":a[7]||(a[7]=e=>t.form.startTime=e),type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"开始时间",disabled:[2,3,4,5,6].includes(t.form.status)},null,8,["modelValue","disabled"])])),_:1})])),_:1}),(0,s.Wm)(p,{span:12},{default:(0,s.w5)((()=>[(0,s.Wm)(d,{prop:"endTime"},{default:(0,s.w5)((()=>[(0,s.Wm)(c,{style:{width:"100%"},modelValue:t.form.endTime,"onUpdate:modelValue":a[8]||(a[8]=e=>t.form.endTime=e),type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"结束时间",disabled:[4,5,6].includes(t.form.status)},null,8,["modelValue","disabled"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,s.Wm)(d,{label:"是否开启店铺限制",prop:"businessShopType"},{default:(0,s.w5)((()=>[(0,s.Wm)(f,{modelValue:t.form.businessShopType,"onUpdate:modelValue":a[9]||(a[9]=e=>t.form.businessShopType=e),disabled:[2,3,4,5,6].includes(t.form.status)},{default:(0,s.w5)((()=>[(0,s.Wm)(h,{label:2},{default:(0,s.w5)((()=>[(0,s.Uk)("是")])),_:1}),(0,s.Wm)(h,{label:1},{default:(0,s.w5)((()=>[(0,s.Uk)("否")])),_:1})])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])}var t=l(2787),i={emits:["success","closed"],props:{deptList:{type:Array,default:()=>[]},researchObjectList:{type:Array,default:()=>[]},researchPeriodList:{type:Array,default:()=>[]}},data(){return{mode:"add",titleMap:{add:"新建打分计划",edit:"编辑店铺"},visible:!1,isSaveing:!1,apiObj:this.$API.researchInfo.ResearchCompany.GetAppraiseSheetList,form:{name:"",sysAppraiseSheetName:"",sysAppraiseSheetNo:"",recoveryTargetCount:"",recoveryDoorsillCount:"",researchObjectType:"",deptType:"",researchPeriodType:"",startTime:"",endTime:"",businessShopType:""},rules:{name:[{required:!0,message:"请输入店铺名称"}],sysAppraiseSheetNo:[{required:!0,message:"请选择评分表"}],recoveryTargetCount:[{required:!0,message:"请输入回收目标数"},{validator:t.C$,trigger:["change","blur"]}],recoveryDoorsillCount:[{required:!0,message:"请输入回收阀值"},{validator:t.C$,trigger:["change","blur"]},{validator:(e,a,l)=>{"add"===this.mode?a>=this.form.recoveryTargetCount?l():l(new Error("回收阀值不得低于回收目标数")):"edit"===this.mode&&(a<this.form.recoveryTargetCount?l(new Error("回收阀值不得低于回收目标数")):a<this.form.completeCount?l(new Error("回收阀值不得低于当前已收集数")):l())},trigger:["change","blur"]}],researchObjectType:[{required:!0,message:"请选择调研对象"}],deptType:[{required:!0,message:"请选择所属部门"}],researchPeriodType:[{required:!0,message:"请选择调研周期"}],startTime:[{required:!0,message:"请选择调研开始时间"}],endTime:[{required:!0,message:"请选择调研结束时间"}],businessShopType:[{required:!0,message:"请选择是否开启店铺限制"}]},sysAppraiseList:[],loading:!1}},mounted(){this.getSysAppraiseList()},methods:{open(e="add"){return this.mode=e,this.visible=!0,this},async getSysAppraiseList(){this.loading=!0;let e={current:1,paramData:{},size:10},a=await this.$API.researchInfo.ResearchCompany.GetAppraiseSheetList.post(e);this.loading=!1,200==a.code?this.sysAppraiseList=a.data.list:this.$alert(a.message,"提示",{type:"error"})},change(e){this.form.sysAppraiseSheetName=this.sysAppraiseList.find((a=>a.no===e))?.name||""},submit(){this.$refs.dialogForm.validate((async e=>{if(e){this.isSaveing=!0;var a=await this.$API.researchInfo.ResearchCompany.CreatePlan.post(this.form);this.isSaveing=!1,200==a.code?(this.$emit("success",this.form,this.mode),this.visible=!1,this.$message.success("操作成功")):this.$alert(a.message,"提示",{type:"error"})}}))},editData(){this.$refs.dialogForm.validate((async e=>{if(!e)return!1;this.isSaveing=!0;var a=await this.$API.researchInfo.ResearchCompany.UpdatePlan.put(this.form.id,this.form);this.isSaveing=!1,200==a.code?(this.$emit("success",this.form,this.mode),this.visible=!1,this.$message.success("操作成功")):this.$alert(a.message,"提示",{type:"error"})}))},async setData(e){this.sysAppraiseList=[{no:e.sysAppraiseSheetNo,name:e.sysAppraiseSheetName}],Object.assign(this.form,e)}}},o=l(3744);const d=(0,o.Z)(i,[["render",r],["__scopeId","data-v-5116d4ac"]]);var u=d}}]);