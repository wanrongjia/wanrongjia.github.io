"use strict";(self["webpackChunkscui"]=self["webpackChunkscui"]||[]).push([[7454],{5878:function(e,t,l){l.r(t),l.d(t,{default:function(){return C}});var a=l(6252),i=l(3577);const s=e=>((0,a.dD)("data-v-327cdf45"),e=e(),(0,a.Cn)(),e),o={class:"left-panel"},n={class:"title"},c={class:"right-panel"},r={class:"longText"},d={class:"label"},u={class:"sheetBox"},m={class:"appraiseSheetName"},p=s((()=>(0,a._)("div",{class:"colorPanel"},[(0,a._)("div",{class:"color-item"},[(0,a._)("div",{class:"block",style:{"--background":"#ffc327"}}),(0,a.Uk)(" 代表-该项已申诉 ")])],-1))),h={key:0},f={key:1},w={key:0};function b(e,t,l,s,b,_){const g=(0,a.up)("el-icon-list"),k=(0,a.up)("el-icon"),S=(0,a.up)("el-button"),v=(0,a.up)("el-header"),L=(0,a.up)("el-form-item"),W=(0,a.up)("el-col"),C=(0,a.up)("el-row"),y=(0,a.up)("el-table-column"),D=(0,a.up)("el-button-group"),N=(0,a.up)("scTable"),x=(0,a.up)("el-main"),Z=(0,a.up)("el-container"),A=(0,a.up)("save-dialog"),z=(0,a.up)("simplePhoto"),P=(0,a.up)("openAppeal");return(0,a.wg)(),(0,a.iD)(a.HY,null,[(0,a.Wm)(Z,null,{default:(0,a.w5)((()=>[(0,a.Wm)(v,{class:"info"},{default:(0,a.w5)((()=>[(0,a._)("div",o,[(0,a.Wm)(k,{size:20,color:"var(--el-color-primary)"},{default:(0,a.w5)((()=>[(0,a.Wm)(g)])),_:1}),(0,a._)("div",n,(0,i.zw)(b.detail.businessShopName),1)]),(0,a._)("div",c,[(0,a.Wm)(S,{size:"default",onClick:_.back},{default:(0,a.w5)((()=>[(0,a.Uk)("返回")])),_:1},8,["onClick"]),(0,a.Wm)(S,{type:"primary",size:"default",onClick:_.showPhoto},{default:(0,a.w5)((()=>[(0,a.Uk)("基础照片")])),_:1},8,["onClick"])])])),_:1}),(0,a.Wm)(x,{style:{background:"#fff"}},{default:(0,a.w5)((()=>[(0,a.Wm)(C,{class:"infoHead"},{default:(0,a.w5)((()=>[(0,a.Wm)(W,{span:16},{default:(0,a.w5)((()=>[(0,a.Wm)(C,null,{default:(0,a.w5)((()=>[(0,a.Wm)(W,{xs:12,sm:12,md:8,lg:8,xl:8},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{label:"客户经理:"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(b.detail.accountManagerName||"-"),1)])),_:1})])),_:1}),(0,a.Wm)(W,{xs:12,sm:12,md:8,lg:8,xl:8},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{label:"区营销部:"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(b.detail.marketingDepartmentName||"-"),1)])),_:1})])),_:1}),(0,a.Wm)(W,{xs:12,sm:12,md:8,lg:8,xl:8},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{label:"区市场部:"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(b.detail.organizationName||"-"),1)])),_:1})])),_:1}),(0,a.Wm)(W,{xs:12,sm:12,md:8,lg:8,xl:8},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{label:"客户名称:"},{default:(0,a.w5)((()=>[(0,a._)("div",r,(0,i.zw)(b.detail.customerName||"-"),1)])),_:1})])),_:1}),(0,a.Wm)(W,{xs:12,sm:12,md:8,lg:8,xl:8},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{label:"专卖证号:"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(b.detail.retailLicenseNumber||"-"),1)])),_:1})])),_:1}),(0,a.Wm)(W,{xs:12,sm:12,md:8,lg:8,xl:8},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{label:"客户电话:"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(b.detail.customerPhone||"-"),1)])),_:1})])),_:1}),(0,a.Wm)(W,{xs:24,sm:24,md:16,lg:16,xl:16},{default:(0,a.w5)((()=>[(0,a.Wm)(L,{label:"调研时间:"},{default:(0,a.w5)((()=>[(0,a.Uk)((0,i.zw)(b.detail.completionTime||"-"),1)])),_:1})])),_:1})])),_:1})])),_:1}),(0,a.Wm)(W,{span:8,class:"successBox"},{default:(0,a.w5)((()=>[(0,a._)("div",d,"总分："+(0,i.zw)(b.detail.totalScore||0),1)])),_:1})])),_:1}),(0,a._)("div",u,[(0,a._)("div",m,[(0,a.Uk)((0,i.zw)(b.detail.sheetName||"-")+" ",1),p]),(0,a.Wm)(N,{ref:"table",data:b.detail.topicListList,"span-method":_.objectSpanMethod,"table-layout":"auto",border:"",hiddenMin:"","highlight-current-row":!1,"row-key":"id",hideRefresh:"",hidePagination:"",hideDo:"","cell-style":_.changeCellStyle},{default:(0,a.w5)((()=>[(0,a.Wm)(y,{label:"检查项目",prop:"className","min-width":"150",align:"center"}),(0,a.Wm)(y,{label:"基本分",prop:"classBaseScore","min-width":"150",align:"center"}),(0,a.Wm)(y,{label:"检查要点",prop:"name","min-width":"500",align:"center"}),(0,a.Wm)(y,{label:"分值",prop:"score","min-width":"100",align:"center"},{default:(0,a.w5)((e=>[b.strShow.includes(e.row.no)?((0,a.wg)(),(0,a.iD)("div",h,"否决项")):((0,a.wg)(),(0,a.iD)("div",f,(0,i.zw)(1===e.row.combineStatus?e.row.combineScore:e.row.score),1))])),_:1}),(0,a.Wm)(y,{label:"得分",prop:"hitScore","min-width":"150",align:"center"},{default:(0,a.w5)((e=>[b.strShow.includes(e.row.no)?((0,a.wg)(),(0,a.iD)("div",w,"-")):((0,a.wg)(),(0,a.iD)("div",{key:1,style:(0,i.j5)(_.filterColor(e.row))},(0,i.zw)(1===e.row.combineStatus?e.row.combineHitScore:e.row.hitScore),5))])),_:1}),(0,a.Wm)(y,{label:"操作","min-width":"100",fixed:"right",align:"center"},{default:(0,a.w5)((e=>[(0,a.Wm)(D,null,{default:(0,a.w5)((()=>[(0,a.Wm)(S,{text:"",type:"primary",size:"small",onClick:t=>_.getData(e.row)},{default:(0,a.w5)((()=>[(0,a.Uk)("查看")])),_:2},1032,["onClick"]),_.filteShow(e.row)?((0,a.wg)(),(0,a.j4)(S,{key:0,text:"",type:"primary",size:"small",onClick:t=>_.getAppeal(e.row)},{default:(0,a.w5)((()=>[(0,a.Uk)("申诉")])),_:2},1032,["onClick"])):(0,a.kq)("",!0)])),_:2},1024)])),_:1})])),_:1},8,["data","span-method","cell-style"])])])),_:1})])),_:1}),b.dialog.save?((0,a.wg)(),(0,a.j4)(A,{key:0,ref:"saveDialog",onSuccess:_.handleSaveSuccess,onClosed:t[0]||(t[0]=e=>b.dialog.save=!1)},null,8,["onSuccess"])):(0,a.kq)("",!0),b.dialog.photo?((0,a.wg)(),(0,a.j4)(z,{key:1,detail:b.detail,ref:"simplePhoto",onClosed:t[1]||(t[1]=e=>b.dialog.photo=!1)},null,8,["detail"])):(0,a.kq)("",!0),b.dialog.appeal?((0,a.wg)(),(0,a.j4)(P,{key:2,ref:"openAppeal",onSuccess:_.handleSaveSuccess,onClose:t[2]||(t[2]=e=>b.dialog.appeal=!1)},null,8,["onSuccess"])):(0,a.kq)("",!0)],64)}l(7658);var _=l(948),g=l(2677),k=l(8443),S=l(8201),v={name:"plan-detail",components:{saveDialog:_["default"],simplePhoto:g["default"],openAppeal:k["default"]},data(){return{id:this.$route.query.id,input:"",dialog:{save:!1,photo:!1,appeal:!1},strShow:["BZXZZD_CLASS_01_TOPIC_01","BZXZZD_CLASS_02_TOPIC_01"],detail:{business:{},images:[],result:{},topicClass:[],topicListList:[]},marketList:[{value:1,label:"城市"},{value:2,label:"乡村"},{value:3,label:"乡镇"}],businessList:[{value:1,label:"便利店"},{value:2,label:"超市"},{value:3,label:"商场"},{value:4,label:"烟酒店"},{value:5,label:"食杂店"},{value:6,label:"娱乐服务"},{value:7,label:"其他"}],spanArr:[]}},created(){},mounted(){this.getDetail(this.$route.query.id)},methods:{changeCellStyle({row:e,column:t,columnIndex:l}){return 4===l&&1===e.status?{background:"#ffc327"}:"操作"===t.label?{background:"#fff"}:{background:"revert"}},filteShow(e){if("BZXZZD_CLASS_02_TOPIC_01"===e.no&&!e.status&&"否"===e.selectOption)return!0;let t=!1;return 1===e.combineStatus?e.combineHitScore<e.combineScore&&!e.status&&(t=!0):e.hitScore<e.score&&!e.status&&(t=!0),t},filterColor(e){let t="";return 1===e.combineStatus?e.combineHitScore<e.combineScore&&(t="color: red;"):e.hitScore<e.score&&(t="color: red;"),t},getSpanArr(e){let t=[];for(var l=0;l<e.length;l++)0===l?(t.push(1),this.pos=0):e[l].classNo===e[l-1].classNo?(t[this.pos]+=1,t.push(0)):(t.push(1),this.pos=l);return t},objectSpanMethod({rowIndex:e,columnIndex:t}){if(0===t||1===t){const t=this.spanArr[e],l=t>0?1:0;return{rowspan:t,colspan:l}}if([3,4].includes(t)){const t=this.detail.topicListList[e-1],l=this.detail.topicListList[e],a=this.detail.topicListList[e+1];if(!a||l.classNo!==a.classNo)return[1,1];if(1===l.combineStatus&&l.combineNo===t.combineNo)return[0,1];if(1===l.combineStatus&&l.combineNo===a.combineNo)return[2,1]}else if([5].includes(t)){const l=this.detail.topicListList[e-2]||{},a=this.detail.topicListList[e-1]||{},i=this.detail.topicListList[e]||{},s=this.detail.topicListList[e+1];if(0===t&&0===e)return[1,1];if("BZXZZD_CLASS_02_TOPIC_01"===i.no&&"否"===i.selectOption)return[3,1];if("BZXZZD_CLASS_02_TOPIC_01"===l.no&&"否"===l.selectOption||"BZXZZD_CLASS_02_TOPIC_01"===a.no&&"否"===a.selectOption)return[0,1];if(!s||i.classNo!==s.classNo)return[1,1];if(1===i.combineStatus&&i.combineNo===a.combineNo)return[0,1];if(1===i.combineStatus&&i.combineNo===s.combineNo)return[2,1]}},getData(e){let t=[];const{combineStatus:l,combineNo:a}=e;switch(l){case 1:t=this.detail.topicListList.filter((e=>e.combineNo===a));break;case 2:t.push(e);break}this.dialog.save=!0,this.$nextTick((()=>{this.$refs.saveDialog.open("add",this.detail.resultId).setData(t)}))},getAppeal(e){let t=[];const{combineStatus:l,combineNo:a}=e;switch(l){case 1:t=this.detail.topicListList.filter((e=>e.combineNo===a));break;case 2:t.push(e);break}this.dialog.appeal=!0,this.$nextTick((()=>{this.$refs.openAppeal.open("add",this.detail.resultId).setData(t)}))},filterType(e,t=[]){return t.find((t=>t.value===e))?.label||"-"},async getDetail(e){let t=await this.$API.researchInfo.ResearchCompany.GetAuditSheetDetail.get(e);200===t.code?(this.detail=t.data||{},this.spanArr=this.getSpanArr(t.data.topicListList)):S.Z.closeNext((()=>{this.$router.back()}))},back(){S.Z.closeNext((()=>{this.$router.back()}))},showPhoto(){this.dialog.photo=!0,this.$nextTick((()=>{this.$refs.simplePhoto.open()}))},handleClick(e){switch(e.props.name){case"1":this.$refs.RecycleDetail.initData();break;case"2":this.$refs.PlanUserList.initData();break;case"3":this.$refs.StoreList.initData();break}},handleSaveSuccess(){this.getDetail(this.id)}}},L=l(3744);const W=(0,L.Z)(v,[["render",b],["__scopeId","data-v-327cdf45"]]);var C=W}}]);